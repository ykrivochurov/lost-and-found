<?xml version="1.0" encoding="UTF-8"?>
<!--suppress SpringSecurityFiltersConfiguredInspection, SpringFacetInspection -->
<beans:beans
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns:beans="http://www.springframework.org/schema/beans"
        xmlns:security="http://www.springframework.org/schema/security"
        xsi:schemaLocation="http://www.springframework.org/schema/beans
       http://www.springframework.org/schema/beans/spring-beans.xsd
       http://www.springframework.org/schema/security
       http://www.springframework.org/schema/security/spring-security.xsd">

    <security:global-method-security secured-annotations="enabled"/>

    <security:http use-expressions="true" auto-config="false" disable-url-rewriting="true" entry-point-ref="authenticationEntryPoint">
        <security:intercept-url pattern="/**" access="permitAll"/>

        <security:custom-filter ref="authenticationFilter" position="BASIC_AUTH_FILTER"/>

        <security:form-login login-processing-url="/api/login" authentication-failure-url="/api/login-process"
                             always-use-default-target="true" default-target-url="/api/login-process" password-parameter="password" username-parameter="username"/>

        <security:logout delete-cookies="true" invalidate-session="true" logout-url="/api/logout"
                         logout-success-url="/api/logout-process"/>

    </security:http>

    <security:authentication-manager alias="authenticationManager">
        <security:ldap-authentication-provider
                user-search-filter="(&amp;(objectClass=user)(sAMAccountName={0}))"
                group-search-filter="(&amp;(objectClass=group)(member={0}))"
                user-context-mapper-ref="userDetailsContextMapper" server-ref="ldapServerContext"/>
    </security:authentication-manager>

    <security:ldap-user-service id="userDetailsService"
                                server-ref="ldapServerContext"
                                user-search-filter="(&amp;(objectClass=user)(sAMAccountName={0}))"
                                group-search-filter="(&amp;(objectClass=group)(member={0}))"
                                user-context-mapper-ref="userDetailsContextMapper"/>

    <security:ldap-server id="ldapServerContext" manager-dn="javaOperator@etr.eastbanctech.ru"
                          manager-password="123QWEasd"
                          url="ldap://etr-dc-01.etr.eastbanctech.ru:389/OU=etr-ru,DC=etr,DC=eastbanctech,DC=ru"/>
</beans:beans>
