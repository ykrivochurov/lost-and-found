<div class="home-wrapper animate-switch-container">
    <div class="left-panel animate-show" ng-show="!isCollapsed">
        <div class="right-panel-show {{!isCollapsed ? 'back' : ''}}" ng-click="collapse()"></div>
        <div class="v-align-table">
            <div class="v-align-cell">
            <div class="top-logo">
                <img class="img-logo" src="/img/icon_left_panel.png">
                <img class="text-logo" src="/img/logos/02_b.png">
                <span class="city">{{currentCity.name}}</span>
            </div>
            <div class="start-form clearfix">
                <input type="text" name="where" placeholder="Где, укажите на карте" ng-model="laf.where">
                <div class="what">
                    <div class="dropdown-toggle input-color">{{laf.tags[0] ? laf.tags[0] : 'Что'}}</div>
                    <ul class="dropdown-menu">
                        <li ng-repeat="category in categories">
                            {{category.name}}
                            <a ng-repeat="tag in category.tags" ng-click="laf.tags = [tag]">{{tag}}</a>
                        </li>
                    </ul>
                </div>
                <input type="text" name="when" placeholder="Когда" datepicker-popup="{{dateFormat}}" show-button-bar="false"
                       show-weeks="false" datepicker-append-to-body="true" ng-model="laf.when">

                <div class="buttons clearfix">
                    <button class="l-button colored-button" ng-click="createItem('LOST')">Я ПОТЕРЯЛ</button>
                    <button class="r-button colored-button" ng-click="createItem('FOUND')">Я НАШЕЛ</button>
                </div>
            </div>
            <div class="show-list clearfix">
                <div class="dashed-text" ng-click="collapse()">Перейти к списку объявлений</div>
            </div>
        </div>
        </div>
    </div>
    <div id="map-panel" class="map-panel"></div>
    <div class="right-panel animate-show {{categoriesListType == 'LOST' ? 'lost-list' : 'found-list'}}" ng-show="isCollapsed">
        <div class="user-panel">
            <div class="login-panel" ng-click="showLoginModal()" ng-show="!authService.currentUserHolder">Войти</div>
            <div class="info-panel" ng-show="authService.currentUserHolder">
                <div class="my-messages-button" ng-click="">1(3)</div>
                <div class="my-items-button" ng-click="showMyItems()">{{authService.currentUserHolder.itemsCount}}</div>
            </div>
        </div>
        <div class="right-panel-hide  {{isCollapsed ? 'back' : ''}}" ng-click="collapse()"></div>
        <div class="top-buttons clearfix">
            <button ng-click="setCategoriesListType('LOST')" class="lost-b active">
                <span>У</span>
                <span>Т</span>
                <span>Е</span>
                <span>Р</span>
                <span>Я</span>
                <span>Н</span>
                <span>О</span>
            </button>
            <button ng-click="setCategoriesListType('FOUND')" class="found-b">
                <span>Н</span>
                <span>А</span>
                <span>Й</span>
                <span>Д</span>
                <span>Е</span>
                <span>Н</span>
                <span>О</span>
            </button>
        </div>
        <div class="search-block left-margin">
            <span>
                <img src="/img/icon_menu.png" alt="">
            </span>
            <input type="text" placeholder="Искать" ng-model="searchQuery"
                   typeahead="thing for thing in whatDict | filter:$viewValue | limitTo:8">
        </div>
        <div class="selected-category left-margin clearfix" ng-show="selectedCategory != null">
            <span class="back" ng-click="selectedItem != null ? goBackToSelectedCategory() : clearCategorySelection()">{{selectedItem != null ? 'К списку объявлений' : 'К списку категорий'}}</span>
            <span class="name-tag">
                {{selectedCategory.name}}
                <span ng-show="selectedTag != null">&nbsp;&nbsp;/&nbsp;&nbsp;{{selectedTag}}&nbsp;&nbsp;{{getCountByTag(selectedTag)}}</span>
            </span>
        </div>
        <div class="nano" style="height: {{itemsListHeight}}px" ng-show="selectedItem != null">
            <div class="content details-block left-margin">
                <div class="creation-date">
                    <span class="day">{{selectedItem.creationDate | date:'dd'}}</span>
                    <span class="month">{{selectedItem.creationDate | date:'MMMM'}}</span>
                    <span class="year">{{selectedItem.creationDate | date:'yyyy'}}</span>
                    <div class="prev-laf-item" ng-show="hasNextItem(selectedItem, true)" ng-click="openNextItem(selectedItem, true)"><img
                            src="/img/top.png" alt="prev"></div>
                    <a href="/#/home?number={{selectedItem.number}}" class="item-number {{selectedItem.itemType == 'LOST' ? 'lost' : 'found'}}" tooltip="Ссылка на объявление"
                       tooltip-placement="bottom" ng-click="$event.stopPropagation();">#&nbsp;{{selectedItem.number}}</a>
                </div>
                <div class="clearfix">
                    <div class="picture">
                        <span class="img-va-helper"></span>
                        <img class="thumbnail-img" src="api/items/photo/{{selectedItem.thumbnailId}}" ng-show="selectedItem.thumbnailId" ng-click="showFullSIzeImage(selectedItem)">
                        <img src="/img/icon_camera.png" ng-show="!selectedItem.photoId">
                    </div>
                    <div class="what">{{selectedItem.what}}</div>
                </div>
                <div class="when-where-section clearfix">
                    <div class="icon-label-b where-b">
                        <div class="label-b">где {{selectedItem.itemType == 'LOST' ? 'утеряно' : 'найдено'}}</div>
                        <div class="text-b">{{selectedItem.where}}</div>
                    </div>
                    <div class="icon-label-b when-b">
                        <div class="label-b">когда {{selectedItem.itemType == 'LOST' ? 'утеряно' : 'найдено'}}</div>
                        <div class="text-b">
                            <span class="day">{{selectedItem.when | date:'dd'}}</span>
                            <span class="month">{{selectedItem.when | date:'MMM'}}</span>
                            <span class="year">{{selectedItem.when | date:'yyyy'}}</span>
                        </div>
                    </div>
                </div>
                <div class="tags-section" ng-show="selectedItem.tags.length > 0">
                    <span class="tags-label">Категории:</span>
                    <span class="tags {{selectedItem.itemType == 'LOST' ? 'lost' : 'found'}}">{{joinTags(selectedItem.tags)}}</span>
                </div>
                <div class="contacts-section clearfix">
                    <div class="clearfix" ng-show="selectedItem.user && selectedItem.user.name">
                        <div class="icon-label-b person-b">
                            <div class="label-b">контактное лицо</div>
                            <div class="text-b">{{selectedItem.user.name}}
                            </div>
                        </div>
                    </div>
                    <div class="clearfix">
                        <div class="icon-label-b phone-b" ng-show="selectedItem.user && selectedItem.user.phone">
                            <div class="text-b">{{selectedItem.user.phone}}</div>
                        </div>
                    </div>
                    <div class="clearfix">
                        <div class="icon-label-b email-b float-left" ng-show="selectedItem.user && selectedItem.user.email">
                            <div class="text-b">{{selectedItem.user.email}}</div>
                        </div>
                    </div>
                    <div class="icon-label-b pen-b" ng-click="createMessage()">
                        <div class="text-b">Написать личное сообщение</div>
                    </div>
                    <div class="next-laf-item" ng-show="hasNextItem(selectedItem, false)" ng-click="openNextItem(selectedItem, false)"><img
                            src="/img/bottom.png" alt="prev"></div>
                </div>
                <div class="share-section">
                    <span>Поделиться</span>
                    <img src="/img/share_twitt.png" alt="Twitter" ng-click="shareService.twitter(selectedItem)">
                    <img src="/img/share_vkontacte.png" alt="ВКонтакте" ng-click="shareService.vkontakte(selectedItem)">
                    <img src="/img/share_facebook.png" alt="Facebook" ng-click="shareService.facebook(selectedItem)">
                    <span class="complain" ng-click="showComplaintModal(selectedItem)">
                        <img src="/img/complain.png" alt="Пожаловаться">
                        Пожаловаться
                    </span>
                </div>
            </div>
        </div>
        <div class="nano items-list-scroll" style="height: {{itemsListHeight}}px" ng-show="showSelectedCategory">
            <div class="content scroll-content" ng-show="showSelectedCategory">
                <div class="laf-item left-margin" ng-repeat="item in itemsList.lostAndFoundItems" ng-click="openItem(item)">
                    <div class="when">
                        <span class="day">{{item.creationDate | date:'dd'}}</span>
                        <span class="month">{{item.creationDate | date:'MMMM'}}</span>
                        <span class="year">{{item.creationDate | date:'yyyy'}}</span>
                        <a href="/#/home?number={{item.number}}" class="item-number {{item.itemType == 'LOST' ? 'lost' : 'found'}}" tooltip="Ссылка на объявление" tooltip-placement="bottom" ng-click="$event.stopPropagation();">#&nbsp;{{item.number}}</a>
                        <span class="money" ng-show="item.money" tooltip="За вознаграждение!" tooltip-placement="left">&nbsp;</span>
                    </div>
                    <div class="what" ng-click="openItem(item)">{{item.what}}</div>
                    <!--todo каждый тэг отдельно кликабельный!!-->
                    <div><span class="tags-label" ng-show="item.tags.length > 1">Категории:</span><span class="tags {{item.itemType == 'LOST' ? 'lost' : 'found'}}"
                                                                                                   ng-show="item.tags.length > 1">{{joinTags(item.tags)}}</span>
                    </div>
                    <div ng-click="showMessages(item)"><span class="messages-label" ng-show="item.messages.length > 0">Сообщения:&nbsp;&nbsp;{{item.messages.length}}</span>
                    </div>
                </div>
                <!--todo кнопка исчо или безконечный скролл-->
            </div>
            <div class="nano-bottom"></div>
        </div>
        <div class="nano categories-list-scroll" style="height: {{categoriesBlockHeight}}px"
             ng-show="showCategoriesList">
            <div class="content scroll-content" ng-show="showCategoriesList">
                <div ng-repeat="category in categories" class="clearfix category-section left-margin">
                    <div class="category" ng-click="selectCategoryAndTag(category, null)">{{category.name}}</div>
                    <div class="tag-w-count clearfix" ng-repeat="tag in category.tags"
                         ng-click="selectCategoryAndTag(category, tag)">
                    <span class="tag-icon">
                        <span class="tag-icon-tc">
                            <img src="{{getIconByTag(tag)}}" alt="">
                        </span>
                    </span>
                    <span class="tag-name">
                        <span class="tag-name-tc">
                            <span>{{tag}}&nbsp;<span class="tag-count">{{getCountByTag(tag)}}</span></span>
                        </span>
                    </span>
                    </div>
                </div>
            </div>
            <div class="nano-bottom"></div>
        </div>
    </div>
</div>

<div ng-show="lafBusy" class="laf-busy">
    <div class="laf-busy-wrapper">
        <div class="laf-busy-text" ng-bind-html="lafBusyMessage">
        </div>
    </div>
</div>

<div class="hidden balloon-content-wrapper">
    <div class="balloon-content">
        <div>
            <div class="when"></div><br/>
            <span class="what"></span>
        </div>
    </div>
</div>

<div class="hidden active-balloon-content-wrapper">
    <div class="balloon-content">
        <div>
            <span class="what"></span>
        </div>
    </div>
</div>

<script type="text/ng-template" id="login-win.html">
    <div class="simple-login">
        <div class="clearfix login-buttons" ng-show="!authService.currentUserHolder.id">
            <button class="vk-login button-base" ng-click="startSpin(); authService.vk.login(setCurrentUser);">
                <img src="/img/button_vk.png">
                Войти через аккаунт Vkontakte
            </button>
            <button class="fb-login button-base" ng-click="startSpin(); authService.fb.login(setCurrentUser);">
                <img src="/img/button_facebook.png">
                Войти через аккаунт Facebook
            </button>
        </div>
    </div>
</script>

<script type="text/ng-template" id="full-size-image.html">
    <div>
        <img src="api/items/photo/{{item.photoId}}" style="max-height: 550px; max-width: 550px;">
    </div>
</script>

<script type="text/ng-template" id="create-message-modal.html">
    <div class="create-message-form">
        <div class="clearfix">
            <div class="item-message">
                <textarea ng-model="message.text" placeholder="Сообщение"></textarea>
            </div>
        </div>

        <div class="clearfix login-buttons" ng-show="authService.currentUserHolder.id">
            <button ng-click="cancel()" class="c-button colored-button">Отмена</button>
            <button ng-click="saveMessage()" class="s-button colored-button">Отправить</button>
        </div>
        <div class="clearfix login-buttons" ng-show="!authService.currentUserHolder.id">
            <button class="vk-login" ng-click="authService.vk.login(setCurrentUser)">
                <img src="/img/button_vk.png">
                Войти через аккаунт Vkontakte
            </button>
            <button class="fb-login" ng-click="authService.fb.login(setCurrentUser)">
                <img src="/img/button_facebook.png">
                Войти через аккаунт Facebook
            </button>
        </div>
    </div>
</script>

<script type="text/ng-template" id="complaint-modal.html">
    <div class="ci-popup complaint-form {{item.itemType == 'LOST' ? 'lost' : 'found'}}">
        <span class="complaint-header">Это объявление некорректно? Пожалуйста, укажите, почему:</span>
        <div class="complaint-reason clearfix">
            <span><label for="complainReason">Выберите причину</label></span>
            <div>
                <div class="dropdown-toggle custom-select">
                    <span class="caret"></span>
                    {{complaint.reason}}
                </div>
                <ul class="dropdown-menu custom-select">
                    <li ng-repeat="reason in reasons" ng-click="complaint.reason = reason">{{reason}}</li>
                </ul>
            </div>
        </div>
        <div class="complaint-text clearfix">
            <span><label for="complainText">Подробности</label></span>
            <div>
                <textarea id="complainText" ng-model="complaint.text"></textarea>
            </div>
        </div>

        <div class="clearfix complaint-buttons">
            <button ng-click="cancel()" class="button-base float-left complaint-cancel">Отмена</button>
            <button ng-click="save()" class="button-base float-right complaint-send">
                <img src="/img/ok.png">
                Отправить
            </button>
        </div>
    </div>
</script>

<script type="text/ng-template" id="create-item-modal.html">

    <div class="ci-popup creation-form {{itemType == 'LOST' ? 'lost' : 'found'}}">
        <div class="creation-date" ng-click="showSpinner()">
            <span class="day">{{laf.creationDate | date:'dd'}}</span>
            <span class="month">{{laf.creationDate | date:'MMMM'}}</span>
            <span class="year">{{laf.creationDate | date:'yyyy'}}</span>
        </div>
        <div class="clearfix">
            <div class="what">
                <textarea ng-model="laf.what" placeholder="Что"></textarea>
            </div>
            <div class="picture-block">
                <span><label for="photos-input">Загрузить фото</label></span>

                <div class="picture">
                    <span class="img-va-helper"></span>
                    <img id="photo-preview" src="/img/icon_camera.png">
                </div>
                <input type="file" class="hidden" name="photos" id="photos-input" ng-model="photoPath" ng-change="uploadPhoto()">
            </div>
        </div>
        <div class="clearfix">
            <div class="where">
                <span>где {{itemType == 'LOST' ? 'утеряно' : 'найдено'}}</span>

                <div>
                    <input type="text" ng-model="laf.where" placeholder="Где">
                </div>
            </div>
            <div class="when">
                <span>когда {{itemType == 'LOST' ? 'утеряно' : 'найдено'}}</span>

                <div>
                    <input type="text" ng-model="laf.when" placeholder="Когда" datepicker-popup="{{dateFormat}}"
                           show-button-bar="false"
                           show-weeks="false" datepicker-append-to-body="true">
                </div>
            </div>
        </div>
        <div class="clearfix">
            <div class="refund-info">
                <label>
                    <input type="checkbox" ng-model="laf.money">
                    <span>{{itemType == 'LOST' ? 'Верните за вознаграждение' : 'Верну за вознаграждение'}}</span>
                </label>
            </div>
        </div>
        <div class="tags clearfix">
            <div class="tags-wrapper" ng-show="laf.tags.length > 0">
                <span class="tags-label">Категории:</span>
                <span ng-repeat="tag in laf.tags" class="tag-value">
                    <span>{{tag}}<img src="/img/close.png" ng-click="removeTag(tag)"></span>
                </span>
            </div>
            <div class="add-tag-button dropdown-toggle">
                Добавить тег
            </div>
            <ul class="dropdown-menu">
                <li ng-repeat="category in categories">
                    {{category.name}}
                    <a ng-repeat="tag in category.tags" ng-click="addTag(tag)">{{tag}}</a>
                </li>
            </ul>
        </div>

        <div ng-show="authService.currentUserHolder.id">
            <div class="private-info">
                <label>
                    <input type="checkbox" ng-model="laf.showPrivateInfo">
                    <span>Публикация контактов</span>
                </label>
            </div>
            <div class="clearfix">
                <div class="user-name">
                    <span>контактное лицо</span>
                    <div>
                        <input type="text" ng-model="authService.currentUserHolder.name">
                    </div>
                </div>
                <div class="email">
                    <span>Емэйл</span>
                    <div>
                        <input type="text" ng-model="authService.currentUserHolder.email">
                    </div>
                </div>
            </div>

            <div class="clearfix">
                <div class="phone">
                    <span>контактный телефон</span>
                    <div>
                        <input type="text" ng-model="authService.currentUserHolder.phone" class="phone-mask">
                    </div>
                </div>
            </div>
        </div>
        <div class="clearfix login-buttons" ng-show="authService.currentUserHolder.id">
            <button ng-click="cancel()" class="c-button colored-button">Отмена</button>
            <button ng-click="saveItem()" class="s-button colored-button">Готово</button>
        </div>
        <div class="clearfix login-buttons" ng-show="!authService.currentUserHolder.id">
            <button class="vk-login button-base" ng-click="authService.vk.login(setCurrentUser)">
                <img src="/img/button_vk.png">
                Войти через аккаунт Vkontakte
            </button>
            <button class="fb-login button-base" ng-click="authService.fb.login(setCurrentUser)">
                <img src="/img/button_facebook.png">
                Войти через аккаунт Facebook
            </button>
        </div>
    </div>
</script>